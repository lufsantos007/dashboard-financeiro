<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Financeiro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>


body{margin:0;font-family:Arial;background:#f2f2f2}
.container{max-width:1200px;margin:auto;padding:15px}
h1{text-align:center}

input,select,button{
  width:100%;
  margin:5px 0;
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

.btn-add{
  background:#3498db;
  color:#fff;
  border:none;
  font-weight:bold;
}

.btn-remove{
  background:#e74c3c;
  color:#fff;
  border:none;
}

.cards{display:flex;flex-direction:column;gap:10px}
.card{background:#fff;padding:15px;border-radius:10px;text-align:center}
.card p{font-size:22px;font-weight:bold;margin:5px 0}

.charts{display:flex;flex-direction:column;gap:20px;margin-top:20px}
.chart-box,.table-box,.form-box{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-top:20px
}

table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #ddd;padding:8px;text-align:center}

@media(min-width:768px){
  .cards{flex-direction:row}
}
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“Š Dashboard Financeiro</h1>

<input type="file" id="file">

<div class="cards">
  <div class="card"><h3>Receitas</h3><p id="receita">R$ 0,00</p></div>
  <div class="card"><h3>Despesas</h3><p id="despesa">R$ 0,00</p></div>
  <div class="card"><h3>Resultado</h3><p id="resultado">R$ 0,00</p></div>
</div>

<div class="charts">
  <div class="chart-box"><canvas id="barChart"></canvas></div>
  <div class="chart-box"><canvas id="pieChart"></canvas></div>
</div>

<div class="form-box">
<h3>âž• Novo LanÃ§amento</h3>

<select id="tipo">
  <option value="Receita">Receita</option>
  <option value="Despesa">Despesa</option>
</select>

<select id="categoria">
  <option>InscriÃ§Ãµes</option>
  <option>PatrocÃ­nio</option>
  <option>Kit do Atleta</option>
  <option>DispersÃ£o / Percurso</option>
  <option>Estrutura</option>
  <option>MÃ£o de Obra</option>
  <option>Despesa Fixa</option>
  <option>Despesas Diversas</option>
</select>

<input id="item" placeholder="Item">
<input id="valor" type="number" placeholder="Valor">

<button class="btn-add" onclick="adicionar()">Adicionar</button>
</div>

<div class="table-box">
<h3>ðŸ“‹ Detalhamento</h3>
<table>
<thead>
<tr>
<th>Categoria</th>
<th>Item</th>
<th>Valor</th>
<th>AÃ§Ã£o</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>

</div>

<script>
let dados = [];
let barChart, pieChart;

const receitaEl = document.getElementById('receita');
const despesaEl = document.getElementById('despesa');
const resultadoEl = document.getElementById('resultado');
const tabelaEl = document.getElementById('tabela');

function parseNumber(v){
  return parseFloat(String(v).replace(/\./g,'').replace(',','.')) || 0;
}

function atualizar(){
  let receita=0, despesa=0, categorias={};

  dados.forEach(d=>{
    if(d.Tipo==='Receita') receita+=d.valor;
    if(d.Tipo==='Despesa'){
      despesa+=d.valor;
      categorias[d.Categoria]=(categorias[d.Categoria]||0)+d.valor;
    }
  });

  const saldo = receita-despesa;

  receitaEl.innerText = receita.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  despesaEl.innerText = despesa.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  resultadoEl.innerText = saldo.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  resultadoEl.style.color = saldo>=0 ? '#2ecc71' : '#e74c3c';

  montarTabela();
  desenharGraficos(receita,despesa,categorias);
  localStorage.setItem('financeiro_evento',JSON.stringify(dados));
}

function montarTabela(){
  tabelaEl.innerHTML='';
  dados.forEach((d,i)=>{
    tabelaEl.innerHTML+=`
    <tr>
      <td>${d.Categoria}</td>
      <td>${d.Item}</td>
      <td>${d.valor.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</td>
      <td><button class="btn-remove" onclick="remover(${i})">Remover</button></td>
    </tr>`;
  });
}

function adicionar(){
  if(!item.value || !valor.value) return;

  dados.push({
    Tipo: tipo.value,
    Categoria: categoria.value,
    Item: item.value,
    valor: parseNumber(valor.value)
  });

  item.value='';
  valor.value='';
  atualizar();
}

function remover(i){
  dados.splice(i,1);
  atualizar();
}

function gerarVermelhos(q){
  return Array.from({length:q},(_,i)=>`rgb(${220-i*120/q},60,60)`);
}

function desenharGraficos(receita,despesa,categorias){
  if(barChart) barChart.destroy();
  if(pieChart) pieChart.destroy();

  barChart = new Chart(barChartEl,{
    type:'bar',
    data:{
      labels:['Receita','Despesa'],
      datasets:[{
        data:[receita,despesa],
        backgroundColor:['#2ecc71','#e74c3c']
      }]
    }
  });

  pieChart = new Chart(pieChartEl,{
    type:'pie',
    data:{
      labels:Object.keys(categorias),
      datasets:[{
        data:Object.values(categorias),
        backgroundColor:gerarVermelhos(Object.keys(categorias).length)
      }]
    }
  });
}

const barChartEl=document.getElementById('barChart');
const pieChartEl=document.getElementById('pieChart');

(function(){
  const s = localStorage.getItem('financeiro_evento');
  if(s){
    dados = JSON.parse(s);
    atualizar();
  }
})();
</script>
</body>
</html>

